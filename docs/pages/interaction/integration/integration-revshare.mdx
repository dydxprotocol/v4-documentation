# Revenue Share

Order Router Rev Share enables third-party order routers to direct orders to dYdX and earn a portion of the trading fees (maker and taker). The revenue share, specified in parts per million (ppm), must be voted in via Governance and set in the `order_router_address` field in the order message itself.

The revenue will be distributed based on filled orders that were routed through the participating order router.

Order router details and revenue share percentages can be monitored through the indexer using the `/orders` and `/fills` endpoints. The `/orders` endpoint provides information on the order router address, while the `/fills` endpoint shows the order router address and the specific revenue amount distributed per fill.

To participate in the Order Router Rev Share program, users need to propose and have a passing vote for their order router address & revenue split.

- Affiliate revenue takes priority in the distribution hierarchy.
- If there is an active affiliate split that has not reached its maximum within a 30-day rolling window, no revenue will be shared with the order router

## Implementation Details

::::steps

## Voting in via Governance

To participate in the Order Router Rev Share program, you need to create and submit a governance proposal. Below are examples of the governance message structure:

```python [Python]
# Example: Set order router revenue share via governance
from dydx_v4_client.node.client import NodeClient

# This method creates the governance message
# Note: This requires governance authority to execute
async def set_order_router_revenue_share_example():
    node = await NodeClient.connect(network.node)
    
    # Set order router revenue share
    # authority: Governance authority address
    # address: Order router address that will receive revenue share
    # share_ppm: Revenue share in parts per million
    response = await node.set_order_router_revenue_share(
        authority="dydx1...",  # Governance authority
        address="dydx1your_router_address",  # Your order router address
        share_ppm=5000  # 0.5% revenue share (5000 parts per million)
    )
    
    print(response)
```

The key components of this message are:

- `address` - The address of the order router that will receive the revenue share. This is also the id you place in your order message
- `sharePpm` - The revenue share percentage in parts per million (ppm).

After submitting the proposal, it must go through the standard governance voting process and receive a passing vote before the order router address and revenue share percentage are activated in the system.

## Updating Revenue Share (Optional)

The process for updating an existing order router's revenue share is the same as setting up a new one. You will need to submit a governance proposal with the updated parameters.

To update the revenue share percentage for an existing order router, create a governance message with the same structure:

```python [Python]
# Update existing order router revenue share
async def update_order_router_revenue_share_example():
    node = await NodeClient.connect(network.node)
    
    # Update with new revenue share percentage
    # Note: address must match the previously approved order router address
    response = await node.set_order_router_revenue_share(
        authority="dydx1...",  # Governance authority
        address="dydx1your_existing_router_address",  # Existing approved address
        share_ppm=7500  # New revenue share: 0.75% (7500 parts per million)
    )
    
    print(response)
```

The proposal must go through the standard governance voting process and receive a passing vote before the updated revenue share percentage takes effect.

:::note

- You must use the exact same address that was previously approved
- The update will completely replace the previous configuration once approved
:::

## Deleting an Order Router Rev Share (Optional)

To delete an order router's revenue share configuration, you simply need to set the revenue share percentage to 0. This process follows the same governance workflow as setting up or updating a revenue share.

Submit a governance proposal with the following message structure:

```python [Python]
# Delete order router revenue share by setting share_ppm to 0
async def delete_order_router_revenue_share_example():
    node = await NodeClient.connect(network.node)
    
    # Set share_ppm to 0 to disable revenue share
    # Note: address must match the previously approved order router address
    response = await node.set_order_router_revenue_share(
        authority="dydx1...",  # Governance authority
        address="dydx1your_existing_router_address",  # Existing approved address
        share_ppm=0  # Setting to 0 disables revenue share
    )
    
    print(response)
```

:::note
Key points to note:

- Setting `sharePpm` to 0 effectively disables the revenue share for that order router
- The address must match the previously approved order router address
- The proposal must still pass through the standard governance voting process
- Once approved, the order router will no longer receive any revenue share

After the proposal passes, any orders that include this order router address will no longer generate revenue share for the router.
:::

## Changes to the Order Message
The `order_router_address` field is set when an order is placed

- `order_router_address` - the ID of the order router and where fees will be sent to

```python [Python]
# Place an order with order router address for revenue share
from dydx_v4_client.node.market import Market
from v4_proto.dydxprotocol.clob.order_pb2 import Order

market = Market(market_data)
current_block = await node.latest_block_height()

new_order = market.order(
    order_id=order_id,
    order_type=OrderType.MARKET,
    side=Order.Side.SIDE_SELL,
    size=0.0001,
    price=0,  # Market order
    time_in_force=Order.TimeInForce.TIME_IN_FORCE_UNSPECIFIED,
    reduce_only=False,
    good_til_block=current_block + 10,
    order_router_address='dydx1your_router_address',  # Order router address (must be voted in via governance)
)

transaction = await node.place_order(
    wallet=wallet,
    order=new_order,
)
```

## Order Validation Checks

- Ensure the `order_router_address` field is valid and already voted in via governance

::::
